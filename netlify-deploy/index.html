<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Assist v2.0 - Multilingual Campus Chatbot | SIH 2024</title>
    <meta name="description" content="Smart India Hackathon 2024 - Multilingual Campus Assistant for student queries in 8 Indian languages">
    <meta name="keywords" content="Smart India Hackathon, SIH 2024, Campus Assistant, Multilingual Chatbot, Hindi, English, Student Queries">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎓</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f8fafc; }
        .chat-container { height: 100vh; display: flex; background: #f3f4f6; }
        .sidebar { background: white; border-right: 1px solid #e5e7eb; transition: all 0.3s; width: 64px; }
        .sidebar.expanded { width: 256px; }
        .sidebar-header { padding: 16px; display: flex; align-items: center; gap: 12px; }
        .menu-btn { padding: 8px; border: none; background: none; border-radius: 8px; cursor: pointer; }
        .menu-btn:hover { background: #f3f4f6; }
        .nav-item { width: 100%; display: flex; align-items: center; gap: 12px; padding: 12px; margin: 4px 8px; border: none; background: none; border-radius: 8px; cursor: pointer; color: #6b7280; }
        .nav-item.active { background: #eff6ff; color: #2563eb; }
        .nav-item:hover { background: #f3f4f6; }
        .main-chat { flex: 1; display: flex; flex-direction: column; }
        .chat-header { background: white; border-bottom: 1px solid #e5e7eb; padding: 16px; display: flex; justify-content: space-between; align-items: center; }
        .header-controls { display: flex; align-items: center; gap: 12px; }
        .language-selector { display: flex; align-items: center; gap: 8px; }
        .language-selector select { border: 1px solid #d1d5db; border-radius: 6px; padding: 4px 12px; font-size: 14px; }
        .human-help-btn { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; cursor: pointer; font-size: 14px; }
        .human-help-btn:hover { background: #f9fafb; }
        .messages-area { flex: 1; overflow-y: auto; padding: 16px; }
        .message { display: flex; gap: 12px; margin-bottom: 16px; }
        .message.user { justify-content: flex-end; }
        .message-content { display: flex; gap: 12px; max-width: 80%; }
        .message.user .message-content { flex-direction: row-reverse; }
        .avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .avatar.bot { background: #dbeafe; color: #2563eb; }
        .avatar.user { background: #f3f4f6; color: #6b7280; }
        .message-bubble { border-radius: 16px; padding: 12px 16px; }
        .message-bubble.bot { background: white; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .message-bubble.user { background: #2563eb; color: white; }
        .message-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .language-tag, .confidence-tag { font-size: 12px; padding: 2px 8px; border-radius: 4px; }
        .language-tag { background: #f3f4f6; color: #374151; }
        .confidence-tag { background: #dbeafe; color: #1d4ed8; }
        .message-text { font-size: 14px; line-height: 1.5; margin-bottom: 4px; }
        .message-time { font-size: 12px; color: #6b7280; }
        .message.user .message-time { color: #bfdbfe; }
        .quick-actions { padding: 16px; }
        .quick-actions-panel { background: white; border-radius: 12px; padding: 16px; border: 1px solid #e5e7eb; }
        .quick-actions-title { font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 12px; }
        .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; }
        /* Hide confidence scores and admin features from students */
        .confidence-tag { display: none !important; }
        .admin-only { display: none !important; }
        .student-view .admin-only { display: none !important; }
        
        /* Improved Quick Actions Design */
        .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .action-btn { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 20px; 
            border: 2px solid #e5e7eb; 
            border-radius: 16px; 
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); 
            cursor: pointer; 
            text-align: left; 
            transition: all 0.3s ease; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .action-btn:hover { 
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); 
            color: white; 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.2);
            border-color: #2563eb;
        }
        .action-icon { color: #2563eb; font-size: 20px; transition: color 0.3s ease; }
        .action-btn:hover .action-icon { color: white; }
        .action-label { font-size: 14px; font-weight: 600; color: #374151; transition: color 0.3s ease; }
        .action-btn:hover .action-label { color: white; }
        
        /* Enhanced Responsive Design */
        @media (max-width: 768px) {
            .chat-container { flex-direction: column; }
            .sidebar { width: 100%; height: 60px; }
            .sidebar.expanded { width: 100%; height: auto; }
            .actions-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
            .action-btn { padding: 16px; font-size: 13px; }
            .action-icon { font-size: 18px; }
            .chat-header { padding: 12px; }
            .header-controls { 
                display: flex; 
                flex-direction: row; 
                gap: 8px; 
                align-items: center; 
                justify-content: space-between; 
            }
            .language-selector { order: 1; }
            .human-help-btn { order: 2; padding: 6px 10px; font-size: 12px; }
            .message-content { max-width: 95%; }
            .quick-actions { padding: 12px; }
        }
        
        @media (max-width: 480px) {
            .actions-grid { grid-template-columns: 1fr; }
            .action-btn { padding: 14px; }
            .chat-header h1 { font-size: 18px; }
            .chat-header p { font-size: 12px; }
        }
        
        /* Enhanced message formatting for better readability */
        .message-text strong { color: #1f2937; font-weight: 700; }
        .message-text .fee-amount { 
            color: #059669; 
            font-weight: 700; 
            font-size: 16px; 
            background: #ecfdf5; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }
        .message-text .deadline { 
            color: #dc2626; 
            font-weight: 600; 
            background: #fef2f2; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }
        .message-text .portal-link { 
            color: #2563eb; 
            font-weight: 600; 
            text-decoration: underline; 
            background: #eff6ff; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }
        .message-text .important-info {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 8px 12px;
            margin: 8px 0;
            border-radius: 6px;
        }
        .input-area { background: white; border-top: 1px solid #e5e7eb; padding: 16px; }
        .input-container { display: flex; gap: 8px; }
        .message-input { flex: 1; border: 1px solid #d1d5db; border-radius: 8px; padding: 12px 16px; font-size: 14px; }
        .message-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .send-btn { padding: 12px 16px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .send-btn:hover { background: #1d4ed8; }
        .send-btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .input-hint { font-size: 12px; color: #6b7280; text-align: center; margin-top: 8px; }
        .loading { display: flex; justify-content: flex-start; }
        .loading-bubble { background: white; border: 1px solid #e5e7eb; border-radius: 16px; padding: 12px 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .loading-content { display: flex; align-items: center; gap: 8px; }
        .spinner { width: 16px; height: 16px; border: 2px solid #e5e7eb; border-top: 2px solid #2563eb; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
        
        /* API Configuration Styles */
        .api-modal {
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .api-config-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Skip Links for Accessibility -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Skip to main content</a>
        <a href="#sidebar" class="skip-link">Skip to navigation</a>
        <a href="#messageInput" class="skip-link">Skip to chat input</a>
    </div>
    
    <!-- Live Regions for Screen Reader Announcements -->
    <div id="live-region" class="live-region" aria-live="polite" aria-atomic="true"></div>
    <div id="assertive-live-region" class="live-region" aria-live="assertive" aria-atomic="true"></div>
    
    <div class="chat-container" role="application" aria-label="Multilingual Campus Assistant">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
                <button class="menu-btn" onclick="toggleSidebar()">☰</button>
                <h2 style="font-weight: bold; color: #111827; display: none;" id="sidebarTitle">Campus Assist</h2>
            </div>
            <nav style="padding: 0 8px;">
                <button class="nav-item active" onclick="showPage('chat')">
                    💬 <span style="display: none;" class="nav-text">Chat</span>
                </button>
                <button class="nav-item" onclick="showPage('knowledge')">
                    📚 <span style="display: none;" class="nav-text">Knowledge Base</span>
                </button>
                <button class="nav-item" onclick="showPage('assets')">
                    💼 <span style="display: none;" class="nav-text">College Assets</span>
                </button>
                <button class="nav-item admin-only" onclick="showPage('analytics')">
                    📊 <span style="display: none;" class="nav-text">Analytics</span>
                </button>
                <button class="nav-item admin-only" onclick="showPage('settings')">
                    ⚙️ <span style="display: none;" class="nav-text">Settings</span>
                </button>
                <button class="nav-item student-only" onclick="showAdminLogin()">
                    🔐 <span style="display: none;" class="nav-text">Admin Login</span>
                </button>
            </nav>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-chat">
            <!-- Enhanced Header with Better Layout -->
            <div class="chat-header">
                <div style="flex: 1;">
                    <h1 style="font-size: 20px; font-weight: bold; color: #111827; margin-bottom: 4px;">Multilingual Campus Assistant</h1>
                    <p style="font-size: 14px; color: #6b7280;">Smart India Hackathon 2024 - Campus Query Solution</p>
                </div>
                <div class="header-controls" style="display: flex; align-items: center; gap: 16px;">
                    <div class="language-selector" style="display: flex; align-items: center; gap: 8px; background: #f8fafc; padding: 8px 12px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <span style="font-size: 16px;">🌐</span>
                        <select onchange="changeLanguage(this.value)" id="languageSelect" style="border: none; background: transparent; font-size: 14px; color: #374151; font-weight: 500;">
                            <option value="en">English</option>
                            <option value="hi">हिंदी</option>
                            <option value="mr">मराठी</option>
                            <option value="gu">ગુજરાતી</option>
                            <option value="bn">বাংলা</option>
                            <option value="ta">தமிழ்</option>
                            <option value="te">తెలుగు</option>
                            <option value="kn">ಕನ್ನಡ</option>
                        </select>
                    </div>
                    <div class="api-config" style="display: flex; align-items: center; gap: 8px;">
                        <button onclick="showApiConfig()" id="apiConfigBtn" class="api-config-btn" style="display: flex; align-items: center; gap: 6px; padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fef2f2; cursor: pointer; font-size: 12px; color: #dc2626;">
                            🔑 <span id="apiStatus">API Key Required</span>
                        </button>
                    </div>
                    <button class="human-help-btn" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; border: 1px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-size: 14px; font-weight: 500; color: #374151; transition: all 0.2s;">📞 Human Help</button>
                </div>
            </div>
            
            <!-- Messages Area -->
            <div class="messages-area" id="messagesArea">
                <div class="message bot">
                    <div class="message-content">
                        <div class="avatar bot">🤖</div>
                        <div class="message-bubble bot">
                            <div class="message-meta">
                                <span class="language-tag">English</span>
                                <span class="confidence-tag">100% confident</span>
                            </div>
                            <div class="message-text" id="greetingText">Hello! I'm your multilingual campus assistant. I can help you with fees, scholarships, timetables, admissions, and other college information. You can talk to me in Hindi, English, or any of our supported regional languages!</div>
                            <div class="message-time" id="greetingTime"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions" id="quickActions">
                <div class="quick-actions-panel">
                    <h3 class="quick-actions-title" id="quickTitle">Quick Help</h3>
                    <div class="actions-grid">
                        <button class="action-btn" onclick="sendQuickMessage('Tell me about fee structure and payment deadlines')">
                            <span class="action-icon">💳</span>
                            <span class="action-label" id="action1">Fee Information</span>
                        </button>
                        <button class="action-btn" onclick="sendQuickMessage('What scholarships are available for students?')">
                            <span class="action-icon">🎓</span>
                            <span class="action-label" id="action2">Scholarships</span>
                        </button>
                        <button class="action-btn" onclick="sendQuickMessage('Show me the current class timetable and schedule')">
                            <span class="action-icon">📅</span>
                            <span class="action-label" id="action3">Timetable</span>
                        </button>
                        <button class="action-btn" onclick="sendQuickMessage('How do I apply for admission? What are the requirements?')">
                            <span class="action-icon">📄</span>
                            <span class="action-label" id="action4">Admissions</span>
                        </button>
                        <button class="action-btn" onclick="sendQuickMessage('When are the upcoming exams and results?')">
                            <span class="action-icon">⏰</span>
                            <span class="action-label" id="action5">Exam Schedule</span>
                        </button>
                        <button class="action-btn" onclick="sendQuickMessage('What can you help me with? Show me all services')">
                            <span class="action-icon">❓</span>
                            <span class="action-label" id="action6">General Help</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <input type="text" id="messageInput" class="message-input" placeholder="Type your question here..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" onclick="sendMessage()">➤</button>
                </div>
                <p class="input-hint" id="inputHint">You can ask questions in Hindi, English, or other Indian languages</p>
            </div>
        </div>
        
        <!-- API Configuration Modal -->
        <div id="apiModal" class="api-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div class="modal-content" style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #111827;">OpenAI API Configuration</h3>
                <p style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">Enter your OpenAI API key to enable intelligent, language-agnostic responses. Your key is stored locally and never shared.</p>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">API Key:</label>
                    <input type="password" id="apiKeyInput" placeholder="sk-..." style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                </div>
                <div id="apiTestResult" style="display: none; padding: 10px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;"></div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeApiModal()" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">Cancel</button>
                    <button onclick="testApiKey()" id="testApiBtn" style="padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer;">Test & Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'en';
        let sidebarExpanded = false;
        let messageCount = 1;
        let isAdminLoggedIn = false;
        let openaiApiKey = '';
        let isApiKeyValid = false;
        
        // Set initial view to student mode
        document.body.className = 'student-view';
        
        const languages = {
            en: {
                greeting: "Hello! I'm your multilingual campus assistant. I can help you with fees, scholarships, timetables, admissions, and other college information. You can talk to me in Hindi, English, or any of our supported regional languages!",
                thinking: "Processing your query...",
                quickTitle: "Quick Help",
                actions: ["Fee Information", "Scholarships", "Timetable", "Admissions", "Exam Schedule", "General Help"],
                placeholder: "Type your question here...",
                hint: "You can ask questions in Hindi, English, or other Indian languages"
            },
            hi: {
                greeting: "नमस्ते! मैं आपका बहुभाषी कैंपस असिस्टेंट हूँ। मैं फीस, छात्रवृत्ति, समय सारणी, प्रवेश और अन्य कॉलेज की जानकारी में आपकी मदद कर सकता हूँ। आप हिंदी, अंग्रेजी या हमारी किसी भी समर्थित क्षेत्रीय भाषा में मुझसे बात कर सकते हैं!",
                thinking: "आपके प्रश्न को समझ रहा हूँ...",
                quickTitle: "त्वरित सहायता",
                actions: ["फीस की जानकारी", "छात्रवृत्ति", "समय सारणी", "प्रवेश", "परीक्षा समय", "सामान्य सहायता"],
                placeholder: "यहाँ अपना प्रश्न लिखें...",
                hint: "आप हिंदी, अंग्रेजी या अन्य भारतीय भाषाओं में प्रश्न पूछ सकते हैं"
            },
            mr: {
                greeting: "नमस्कार! मी तुमचा बहुभाषी कॅम्पस असिस्टेंट आहे। मी फी, शिष्यवृत्ती, वेळापत्रक, प्रवेश आणि इतर महाविद्यालयीन माहितीमध्ये तुमची मदत करू शकतो। तुम्ही मराठी, हिंदी, इंग्रजी किंवा आमच्या कोणत्याही समर्थित प्रादेशिक भाषेत माझ्याशी बोलू शकता!",
                thinking: "तुमचा प्रश्न समजून घेत आहे...",
                quickTitle: "द्रुत मदत",
                actions: ["फी माहिती", "शिष्यवृत्ती", "वेळापत्रक", "प्रवेश", "परीक्षा वेळापत्रक", "सामान्य मदत"],
                placeholder: "येथे तुमचा प्रश्न टाइप करा...",
                hint: "तुम्ही मराठी, हिंदी, इंग्रजी किंवा इतर भारतीय भाषांमध्ये प्रश्न विचारू शकता"
            },
            gu: {
                greeting: "નમસ્તે! હું તમારો બહુભાષી કેમ્પસ સહાયક છું। હું ફી, શિષ્યવૃત્તિ, સમયપત્રક, પ્રવેશ અને અન્ય કોલેજની માહિતીમાં તમારી મદદ કરી શકું છું। તમે ગુજરાતી, હિન્દી, અંગ્રેજી અથવા અમારી કોઈપણ સમર્થિત પ્રાદેશિક ભાષામાં મારી સાથે વાત કરી શકો છો!",
                thinking: "તમારા પ્રશ્નને સમજી રહ્યો છું...",
                quickTitle: "ઝડપી મદદ",
                actions: ["ફી માહિતી", "શિષ્યવૃત્તિ", "સમયપત્રક", "પ્રવેશ", "પરીક્ષા શેડ્યૂલ", "સામાન્ય મદદ"],
                placeholder: "અહીં તમારો પ્રશ્ન લખો...",
                hint: "તમે ગુજરાતી, હિન્દી, અંગ્રેજી અથવા અન્ય ભારતીય ભાષાઓમાં પ્રશ્નો પૂછી શકો છો"
            },
            bn: {
                greeting: "নমস্কার! আমি আপনার বহুভাষিক ক্যাম্পাস সহায়ক। আমি ফি, বৃত্তি, সময়সূচী, ভর্তি এবং অন্যান্য কলেজ তথ্যে আপনাকে সাহায্য করতে পারি। আপনি বাংলা, হিন্দি, ইংরেজি বা আমাদের যেকোনো সমর্থিত আঞ্চলিক ভাষায় আমার সাথে কথা বলতে পারেন!",
                thinking: "আপনার প্রশ্ন বুঝতে চেষ্টা করছি...",
                quickTitle: "দ্রুত সাহায্য",
                actions: ["ফি তথ্য", "বৃত্তি", "সময়সূচী", "ভর্তি", "পরীক্ষার সময়সূচী", "সাধারণ সাহায্য"],
                placeholder: "এখানে আপনার প্রশ্ন টাইপ করুন...",
                hint: "আপনি বাংলা, হিন্দি, ইংরেজি বা অন্যান্য ভারতীয় ভাষায় প্রশ্ন জিজ্ঞাসা করতে পারেন"
            },
            ta: {
                greeting: "வணக்கம்! நான் உங்கள் பன்மொழி வளாக உதவியாளர். கட்டணம், உதவித்தொகை, நேர அட்டவணை, சேர்க்கை மற்றும் பிற கல்லூரி தகவல்களில் உங்களுக்கு உதவ முடியும். நீங்கள் தமிழ், இந்தி, ஆங்கிலம் அல்லது எங்கள் ஆதரவளிக்கும் பிராந்திய மொழிகளில் என்னுடன் பேசலாம்!",
                thinking: "உங்கள் கேள்வியைப் புரிந்து கொள்கிறேன்...",
                quickTitle: "விரைவு உதவி",
                actions: ["கட்டண தகவல்", "உதவித்தொகை", "நேர அட்டவணை", "சேர்க்கை", "தேர்வு அட்டவணை", "பொது உதவி"],
                placeholder: "உங்கள் கேள்வியை இங்கே தட்டச்சு செய்யுங்கள்...",
                hint: "நீங்கள் தமிழ், இந்தி, ஆங்கிலம் அல்லது பிற இந்திய மொழிகளில் கேள்விகள் கேட்கலாம்"
            },
            te: {
                greeting: "నమస్కారం! నేను మీ బహుభాషా క్యాంపస్ సహాయకుడను। ఫీజులు, స్కాలర్‌షిప్‌లు, టైమ్‌టేబుల్‌లు, అడ్మిషన్లు మరియు ఇతర కాలేజీ సమాచారంలో మీకు సహాయం చేయగలను। మీరు తెలుగు, హిందీ, ఇంగ్లీష్ లేదా మా మద్దతిచ్చే ప్రాంతీయ భాషలలో నాతో మాట్లాడవచ్చు!",
                thinking: "మీ ప్రశ్నను అర్థం చేసుకుంటున్నాను...",
                quickTitle: "త్వరిత సహాయం",
                actions: ["ఫీజు సమాచారం", "స్కాలర్‌షిప్‌లు", "టైమ్‌టేబుల్", "అడ్మిషన్లు", "పరీక్ష షెడ్యూల్", "సాధారణ సహాయం"],
                placeholder: "మీ ప్రశ్నను ఇక్కడ టైప్ చేయండి...",
                hint: "మీరు తెలుగు, హిందీ, ఇంగ్లీష్ లేదా ఇతర భారతీయ భాషలలో ప్రశ్నలు అడగవచ్చు"
            },
            kn: {
                greeting: "ನಮಸ್ಕಾರ! ನಾನು ನಿಮ್ಮ ಬಹುಭಾಷಾ ಕ್ಯಾಂಪಸ್ ಸಹಾಯಕ. ಶುಲ್ಕ, ವಿದ್ಯಾರ್ಥಿವೇತನ, ವೇಳಾಪಟ್ಟಿ, ಪ್ರವೇಶ ಮತ್ತು ಇತರ ಕಾಲೇಜು ಮಾಹಿತಿಯಲ್ಲಿ ನಿಮಗೆ ಸಹಾಯ ಮಾಡಬಲ್ಲೆ। ನೀವು ಕನ್ನಡ, ಹಿಂದಿ, ಇಂಗ್ಲಿಷ್ ಅಥವಾ ನಮ್ಮ ಬೆಂಬಲಿತ ಪ್ರಾದೇಶಿಕ ಭಾಷೆಗಳಲ್ಲಿ ನನ್ನೊಂದಿಗೆ ಮಾತನಾಡಬಹುದು!",
                thinking: "ನಿಮ್ಮ ಪ್ರಶ್ನೆಯನ್ನು ಅರ್ಥಮಾಡಿಕೊಳ್ಳುತ್ತಿದ್ದೇನೆ...",
                quickTitle: "ತ್ವರಿತ ಸಹಾಯ",
                actions: ["ಶುಲ್ಕ ಮಾಹಿತಿ", "ವಿದ್ಯಾರ್ಥಿವೇತನ", "ವೇಳಾಪಟ್ಟಿ", "ಪ್ರವೇಶ", "ಪರೀಕ್ಷಾ ವೇಳಾಪಟ್ಟಿ", "ಸಾಮಾನ್ಯ ಸಹಾಯ"],
                placeholder: "ನಿಮ್ಮ ಪ್ರಶ್ನೆಯನ್ನು ಇಲ್ಲಿ ಟೈಪ್ ಮಾಡಿ...",
                hint: "ನೀವು ಕನ್ನಡ, ಹಿಂದಿ, ಇಂಗ್ಲಿಷ್ ಅಥವಾ ಇತರ ಭಾರತೀಯ ಭಾಷೆಗಳಲ್ಲಿ ಪ್ರಶ್ನೆಗಳನ್ನು ಕೇಳಬಹುದು"
            }
        };

        function showPage(page) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Add active class to clicked nav item
            event.target.classList.add('active');
            
            // For now, just keep the chat interface visible
            // In future, we can add actual page switching here
            console.log('Switching to page:', page);
        }
        
        function showApiConfig() {
            document.getElementById('apiModal').style.display = 'flex';
        }
        
        function closeApiModal() {
            document.getElementById('apiModal').style.display = 'none';
        }
        
        async function testApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const testBtn = document.getElementById('testApiBtn');
            const resultDiv = document.getElementById('apiTestResult');
            
            if (!apiKey) {
                showApiResult('Please enter an API key', 'error');
                return;
            }
            
            testBtn.textContent = 'Testing...';
            testBtn.disabled = true;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 5
                    })
                });
                
                if (response.ok) {
                    openaiApiKey = apiKey;
                    isApiKeyValid = true;
                    localStorage.setItem('openai_api_key', apiKey);
                    updateApiStatus(true);
                    showApiResult('✅ API key verified successfully!', 'success');
                    setTimeout(() => {
                        closeApiModal();
                    }, 1500);
                } else {
                    throw new Error('Invalid API key');
                }
            } catch (error) {
                showApiResult('❌ Invalid API key. Please check and try again.', 'error');
            } finally {
                testBtn.textContent = 'Test & Save';
                testBtn.disabled = false;
            }
        }
        
        function showApiResult(message, type) {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = message;
            resultDiv.style.background = type === 'success' ? '#f0fdf4' : '#fef2f2';
            resultDiv.style.color = type === 'success' ? '#166534' : '#dc2626';
            resultDiv.style.border = `1px solid ${type === 'success' ? '#bbf7d0' : '#fecaca'}`;
        }
        
        function updateApiStatus(isValid) {
            const statusSpan = document.getElementById('apiStatus');
            const configBtn = document.getElementById('apiConfigBtn');
            
            if (isValid) {
                statusSpan.textContent = 'API Connected';
                configBtn.style.background = '#f0fdf4';
                configBtn.style.color = '#166534';
                configBtn.style.borderColor = '#bbf7d0';
            } else {
                statusSpan.textContent = 'API Key Required';
                configBtn.style.background = '#fef2f2';
                configBtn.style.color = '#dc2626';
                configBtn.style.borderColor = '#fecaca';
            }
        }
        
        async function getOpenAIResponse(userMessage, detectedLanguage) {
            if (!isApiKeyValid || !openaiApiKey) {
                return "Please configure your OpenAI API key to enable intelligent responses.";
            }
            
            try {
                const systemPrompt = `You are a helpful campus assistant chatbot. The user's message may be in mixed languages including English, Hindi, Marathi, Gujarati, Bengali, Tamil, Telugu, or Kannada. 
                
User's preferred response language: ${getLanguageName(currentLanguage)}
                
Provide helpful responses about:
                - College fees and payment information
                - Scholarships and financial aid
                - Academic timetables and schedules
                - Admission procedures
                - Exam schedules and results
                - General college information
                
Always respond in the user's preferred language (${getLanguageName(currentLanguage)}). Format important information like fees, dates, and links with appropriate emphasis.`;
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openaiApiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userMessage }
                        ],
                        max_tokens: 300,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                return data.choices[0].message.content.trim();
                
            } catch (error) {
                console.error('OpenAI API error:', error);
                return generateResponse(userMessage); // Fallback to local responses
            }
        }
        
        function getLanguageName(langCode) {
            const langNames = {
                'en': 'English',
                'hi': 'Hindi (हिंदी)',
                'mr': 'Marathi (मराठी)',
                'gu': 'Gujarati (ગુજરાતી)',
                'bn': 'Bengali (বাংলা)',
                'ta': 'Tamil (தமிழ்)',
                'te': 'Telugu (తెలుగు)',
                'kn': 'Kannada (ಕನ್ನಡ)'
            };
            return langNames[langCode] || 'English';
        }

        // Enhanced Language Processor with Intent Recognition
        class LanguageProcessor {
            constructor() {
                this.languagePatterns = {
                    hi: /[\u0900-\u097F]/,
                    mr: /[\u0900-\u097F]/,
                    gu: /[\u0A80-\u0AFF]/,
                    bn: /[\u0980-\u09FF]/,
                    ta: /[\u0B80-\u0BFF]/,
                    te: /[\u0C00-\u0C7F]/,
                    kn: /[\u0C80-\u0CFF]/
                };
                this.contextMemory = new Map();
                this.responseGenerator = new ResponseGenerator();
            }

            detectLanguage(text) {
                let maxMatches = 0;
                let detectedLang = 'en';
                
                for (const [lang, pattern] of Object.entries(this.languagePatterns)) {
                    const matches = (text.match(pattern) || []).length;
                    if (matches > maxMatches) {
                        maxMatches = matches;
                        detectedLang = lang;
                    }
                }
                
                return detectedLang;
            }

            classifyIntent(message, language) {
                const intents = {
                    fees: {
                        keywords: {
                            en: ['fee', 'fees', 'payment', 'cost', 'amount', 'money', 'pay'],
                            hi: ['शुल्क', 'फीस', 'पैसा', 'भुगतान'],
                            mr: ['शुल्क', 'फी', 'पैसे', 'पेमेंट']
                        }
                    },
                    scholarship: {
                        keywords: {
                            en: ['scholarship', 'grant', 'financial aid', 'stipend'],
                            hi: ['छात्रवृत्ति', 'अनुदान'],
                            mr: ['शिष्यवृत्ती', 'अनुदान']
                        }
                    }
                };
                
                const messageLower = message.toLowerCase();
                const scores = {};
                
                for (const [intentName, intentData] of Object.entries(intents)) {
                    const keywords = intentData.keywords[language] || intentData.keywords.en;
                    let score = 0;
                    
                    keywords.forEach(keyword => {
                        if (messageLower.includes(keyword.toLowerCase())) {
                            score += 1;
                        }
                    });
                    
                    scores[intentName] = score;
                }
                
                const bestIntent = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
                
                if (bestIntent[1] > 0) {
                    return {
                        intent: bestIntent[0],
                        confidence: Math.min(bestIntent[1] / 3, 1)
                    };
                }
                
                return { intent: 'general', confidence: 0.5 };
            }

            async processMessage(message, userId = 'default') {
                const detectedLang = this.detectLanguage(message);
                const context = this.getContext(userId);
                const intent = this.classifyIntent(message, detectedLang);
                
                this.updateContext(userId, {
                    message,
                    language: detectedLang,
                    intent: intent,
                    timestamp: Date.now()
                });

                return {
                    originalMessage: message,
                    detectedLanguage: detectedLang,
                    intent: intent,
                    context: context,
                    confidence: intent.confidence
                };
            }

            getContext(userId) {
                return this.contextMemory.get(userId) || [];
            }

            updateContext(userId, messageData) {
                const context = this.getContext(userId);
                context.push(messageData);
                
                if (context.length > 10) {
                    context.shift();
                }
                
                this.contextMemory.set(userId, context);
            }
        }
        
        // Response Generator
        class ResponseGenerator {
            constructor() {
                this.responses = {
                    fees: {
                        en: "**Fee Information**: Tuition fees are ₹50,000 per semester. Payment deadline is 15th of each month. You can pay online through the college portal or visit the accounts office.",
                        hi: "**फीस की जानकारी**: ट्यूशन फीस प्रति सेमेस्टर ₹50,000 है। भुगतान की अंतिम तारीख हर महीने की 15 तारीख है।",
                        mr: "**फी माहिती**: शिक्षण शुल्क प्रति सत्र ₹50,000 आहे। पेमेंटची अंतिम तारीख दर महिन्याच्या 15 तारखेला आहे।"
                    },
                    scholarship: {
                        en: "**Scholarship Information**: Merit-based scholarships available for students with 85%+ marks. Need-based scholarships for annual family income below ₹2 lakhs. Application deadline: March 31st.",
                        hi: "**छात्रवृत्ति की जानकारी**: 85%+ अंक वाले छात्रों के लिए मेधा आधारित छात्रवृत्ति उपलब्ध।",
                        mr: "**शिष्यवृत्तीची माहिती**: 85%+ गुण असलेल्या विद्यार्थ्यांसाठी गुणवत्ता आधारित शिष्यवृत्ती उपलब्ध।"
                    },
                    general: {
                        en: "I'm here to help with information about fees, scholarships, timetables, admissions, exams, and other college-related queries. Please feel free to ask specific questions!",
                        hi: "मैं फीस, छात्रवृत्ति, समय सारणी, प्रवेश, परीक्षा और अन्य कॉलेज संबंधी प्रश्नों में आपकी सहायता के लिए यहाँ हूँ।",
                        mr: "मी फी, शिष्यवृत्ती, वेळापत्रक, प्रवेश, परीक्षा आणि इतर महाविद्यालयीन प्रश्नांमध्ये तुमची मदत करण्यासाठी येथे आहे।"
                    }
                };
            }
            
            generateResponse(intent, language, context = []) {
                const intentResponses = this.responses[intent] || this.responses.general;
                return intentResponses[language] || intentResponses.en;
            }
        }

        // Initialize enhanced language processor
        const languageProcessor = new LanguageProcessor();

        // Voice Interface System
        class VoiceInterface {
            constructor() {
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.isListening = false;
                this.isSupported = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                
                if (this.isSupported) {
                    this.initSpeechRecognition();
                }
            }

            initSpeechRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.maxAlternatives = 1;
                
                this.updateLanguage(currentLanguage);
                
                this.recognition.onstart = () => {
                    this.isListening = true;
                    this.updateVoiceButton(true);
                };
                
                this.recognition.onend = () => {
                    this.isListening = false;
                    this.updateVoiceButton(false);
                };
                
                this.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('messageInput').value = transcript;
                    sendMessage();
                };
                
                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    this.isListening = false;
                    this.updateVoiceButton(false);
                };
            }

            updateLanguage(langCode) {
                if (!this.recognition) return;
                
                const speechLangMap = {
                    'en': 'en-IN',
                    'hi': 'hi-IN',
                    'mr': 'mr-IN',
                    'gu': 'gu-IN',
                    'bn': 'bn-IN',
                    'ta': 'ta-IN',
                    'te': 'te-IN',
                    'kn': 'kn-IN'
                };
                
                this.recognition.lang = speechLangMap[langCode] || 'en-IN';
            }

            toggleListening() {
                if (!this.isSupported) {
                    alert('Voice input is not supported in your browser. Please use Chrome or Edge.');
                    return;
                }
                
                if (this.isListening) {
                    this.recognition.stop();
                } else {
                    this.recognition.start();
                }
            }

            speak(text, language = currentLanguage) {
                if (!this.synthesis) return;
                
                this.synthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                const voices = this.synthesis.getVoices();
                const languageVoice = voices.find(voice => 
                    voice.lang.startsWith(language === 'en' ? 'en' : 'hi')
                );
                
                if (languageVoice) {
                    utterance.voice = languageVoice;
                }
                
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                this.synthesis.speak(utterance);
            }

            updateVoiceButton(isListening) {
                const voiceBtn = document.getElementById('voiceBtn');
                if (voiceBtn) {
                    if (isListening) {
                        voiceBtn.innerHTML = '🔴 Listening...';
                        voiceBtn.style.background = '#fef2f2';
                        voiceBtn.style.borderColor = '#fecaca';
                        voiceBtn.style.color = '#dc2626';
                    } else {
                        voiceBtn.innerHTML = '🎤 Voice';
                        voiceBtn.style.background = 'white';
                        voiceBtn.style.borderColor = '#e5e7eb';
                        voiceBtn.style.color = '#374151';
                    }
                }
            }
        }

        // Initialize voice interface
        const voiceInterface = new VoiceInterface();

        // Accessibility Manager
        class AccessibilityManager {
            constructor() {
                this.screenReaderSupport = false;
                this.highContrastMode = false;
                this.largeTextMode = false;
                this.reducedMotion = false;
                this.initializeAccessibility();
            }

            initializeAccessibility() {
                this.detectScreenReader();
                this.setupKeyboardNavigation();
                this.setupHighContrastMode();
                this.setupReducedMotion();
                this.setupLiveRegions();
            }

            detectScreenReader() {
                this.screenReaderSupport = !!(navigator.userAgent.includes('NVDA') ||
                    navigator.userAgent.includes('JAWS') ||
                    window.speechSynthesis);
                
                if (this.screenReaderSupport) {
                    document.body.classList.add('screen-reader-active');
                    this.announceToScreenReader('Campus Assistant loaded. Screen reader support enabled.');
                }
            }

            setupKeyboardNavigation() {
                document.addEventListener('keydown', (event) => {
                    switch (event.key) {
                        case 'Escape':
                            this.handleEscape();
                            break;
                        case 'F6':
                            this.handleRegionNavigation(event);
                            break;
                    }
                });
            }

            setupHighContrastMode() {
                const prefersHighContrast = window.matchMedia('(prefers-contrast: high)').matches;
                if (prefersHighContrast) {
                    this.enableHighContrastMode();
                }
                
                window.matchMedia('(prefers-contrast: high)').addListener((e) => {
                    if (e.matches) {
                        this.enableHighContrastMode();
                    } else {
                        this.disableHighContrastMode();
                    }
                });
            }

            setupReducedMotion() {
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                if (prefersReducedMotion) {
                    this.enableReducedMotion();
                }
            }

            setupLiveRegions() {
                // Live regions are already in HTML
            }

            enableHighContrastMode() {
                this.highContrastMode = true;
                document.body.classList.add('high-contrast');
                this.announceToScreenReader('High contrast mode enabled');
            }

            disableHighContrastMode() {
                this.highContrastMode = false;
                document.body.classList.remove('high-contrast');
            }

            enableReducedMotion() {
                this.reducedMotion = true;
                document.body.classList.add('reduced-motion');
            }

            handleEscape() {
                const modal = document.querySelector('#apiModal:not(.hidden)');
                if (modal && modal.style.display !== 'none') {
                    closeApiModal();
                    this.announceToScreenReader('Dialog closed');
                }
            }

            announceToScreenReader(message, urgent = false) {
                const liveRegionId = urgent ? 'assertive-live-region' : 'live-region';
                const liveRegion = document.getElementById(liveRegionId);
                
                if (liveRegion) {
                    liveRegion.textContent = message;
                    setTimeout(() => {
                        liveRegion.textContent = '';
                    }, 1000);
                }
            }

            toggleLargeTextMode() {
                this.largeTextMode = !this.largeTextMode;
                
                if (this.largeTextMode) {
                    document.body.classList.add('large-text');
                    this.announceToScreenReader('Large text mode enabled');
                } else {
                    document.body.classList.remove('large-text');
                    this.announceToScreenReader('Large text mode disabled');
                }
            }
        }

        // Initialize accessibility manager
        const accessibilityManager = new AccessibilityManager();

        function toggleVoiceInput() {
            voiceInterface.toggleListening();
        }
        document.getElementById('greetingTime').textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        // Enhanced sendMessage function with multilingual processing
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;
            
            input.value = '';
            addMessage(message, 'user');
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Process with language processor
                const processed = await languageProcessor.processMessage(message);
                
                let response;
                if (isApiKeyValid) {
                    // Use OpenAI for intelligent response
                    response = await getOpenAIResponse(message, processed.detectedLanguage);
                } else {
                    // Use local response generation
                    response = languageProcessor.responseGenerator.generateResponse(
                        processed.intent.intent, 
                        currentLanguage, 
                        processed.context
                    );
                }
                
                // Add bot response with language info
                hideTypingIndicator();
                addMessage(response, 'bot', {
                    language: processed.detectedLanguage,
                    confidence: processed.intent.confidence,
                    intent: processed.intent.intent
                });
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                console.error('Message processing error:', error);
            }
        }
        
        // Enhanced addMessage function
        function addMessage(text, sender, metadata = {}) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const languageName = getLanguageName(metadata.language || currentLanguage);
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="avatar ${sender}">${sender === 'bot' ? '🤖' : '👤'}</div>
                    <div class="message-bubble ${sender}">
                        ${sender === 'bot' ? `
                        <div class="message-meta">
                            <span class="language-tag">${languageName}</span>
                            ${metadata.confidence ? `<span class="confidence-tag">${Math.round(metadata.confidence * 100)}% confident</span>` : ''}
                        </div>` : ''}
                        <div class="message-text">${formatBotResponse(text)}</div>
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            
            // Speak response if voice is enabled and it's a bot message
            if (sender === 'bot' && voiceInterface) {
                setTimeout(() => voiceInterface.speak(text, currentLanguage), 500);
            }
        }
        
        // Format bot responses with emphasis
        function formatBotResponse(text) {
            return text
                .replace(/(₹[\d,]+)/g, '<span class="fee-amount">$1</span>')
                .replace(/(\d{1,2}[-/]\d{1,2}[-/]\d{2,4})/g, '<span class="deadline">$1</span>')
                .replace(/(portal|website|gov\.in)/gi, '<span class="portal-link">$1</span>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }
        
        function showTypingIndicator() {
            const messagesArea = document.getElementById('messagesArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot loading';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-content">
                    <div class="avatar bot">🤖</div>
                    <div class="loading-bubble">
                        <div class="loading-content">
                            <div class="spinner"></div>
                            <span id="thinkingText">${languages[currentLanguage]?.thinking || 'Processing your query...'}</span>
                        </div>
                    </div>
                </div>
            `;
            messagesArea.appendChild(typingDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }
        
        // Initialize API
        async function initializeAPI() {
            const storedKey = localStorage.getItem('openai_api_key');
            if (storedKey) {
                openaiApiKey = storedKey;
                isApiKeyValid = true;
                updateApiStatus(true);
            }
        }
        
        initializeAPI();
        
        // Voice interface integration
        function changeLanguage(language) {
            currentLanguage = language;
            updateUI();
            if (voiceInterface) {
                voiceInterface.updateLanguage(language);
            }
        }
    </script>
</body>
</html>